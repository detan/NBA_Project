{
    "contents" : "library(rJava)\nlibrary(xlsx)\nlibrary(data.table)\nlibrary(plyr)\nlibrary(dplyr)\n\nSeasonCurrent = 2013\nRecordGameInfo <- read.table(sprintf(\"~/Documents/Sport_analysis/basketball//Pred_Data//RecordGameInfo_%s.txt\", SeasonCurrent), \n                              header = TRUE, sep = \"\\t\")\nBettingData <- read.table(sprintf(\"~/Documents/Sport_analysis/basketball//Betting_Data//Batting_Data_pointspreads_%s.txt\", SeasonCurrent), \n                          header = TRUE, sep = \"\\t\")\nNBATeamName <- read.xlsx2(\"~/Documents/Sport_analysis/basketball//Team_Data//NBA_Team_Name.xlsx\", \n                          sheetIndex = as.character(SeasonCurrent), header = TRUE)\n\n### delete the noise information\nsearchword <- c(\"Conference\", \"West\", \"All Star\", \"Western\", \"Team\")\nidx <- unlist(apply(as.data.frame(searchword), 1, function(x) grep(x, BettingData$Away_Team)))\nif(length(idx) != 0){\n  BettingData <- BettingData[-idx, ]  \n}\n\n### convert the money line to point line\nBettingData$OddAway_BET365 <- round(with(BettingData, ifelse(bet365_Away>0, (bet365_Away/100)+1, (100/-bet365_Away)+1)), 2)\nBettingData$OddHome_BET365 <- round(with(BettingData, ifelse(bet365_Home>0, (bet365_Home/100)+1, (100/-bet365_Home)+1)), 2)\nBettingData$spreadsOddAway_BET365 <- round(with(BettingData, ifelse(spreadline_bet365_Away>0, (spreadline_bet365_Away/100)+1, (100/-spreadline_bet365_Away)+1)), 2)\nBettingData$spreadsOddHome_BET365 <- round(with(BettingData, ifelse(spreadline_bet365_Home>0, (spreadline_bet365_Home/100)+1, (100/-spreadline_bet365_Home)+1)), 2)\n### calculate the win percent \n#BettingData$BettingWPAway_BET365 <- round(with(BettingData, 1/BettingAway_BET365), 4)\n#BettingData$BettingWPHome_BET365 <- round(with(BettingData, 1/BettingHome_BET365), 4)\n#BettingData$BettingWPAway_5Dimes <- round(with(BettingData, ifelse(X5Dimes_Away>0, 100/(100+X5Dimes_Away), abs(X5Dimes_Away)/(abs(X5Dimes_Away)+100))), 4)\n#BettingData$BettingWPHome_5Dimes <- round(with(BettingData, ifelse(X5Dimes_Home>0, 100/(100+X5Dimes_Home), abs(X5Dimes_Home)/(abs(X5Dimes_Home)+100))), 4)\n#BettingData$BettingWPTotal_BET365 <- with(BettingData, BettingWPAway+BettingWPHome)\n\n### merge RecordGameInfo and BettingData\nlibrary(psych)\n# NBATeamName must be data.frame format\nmatchAwayTeam <- lookup(BettingData[, \"Away_Team\"], NBATeamName[, c(\"Team_Short_Name\", \"Team_Name_Betting\")], c1 = 2)[, 1]\nmatchHomeTeam <- lookup(BettingData[, \"Home_Team\"], NBATeamName[, c(\"Team_Short_Name\", \"Team_Name_Betting\")], c1 = 2)[, 1]\nBettingData$shortAwayTeam <- matchAwayTeam\nBettingData$shortHomeTeam <- matchHomeTeam\ncolnames(BettingData) <- c(\"GameDate\", \"Away_Team\",  \"Home_Team\", \"bet365_Away\", \"bet365_Home\", \"X5Dimes_Away\", \"X5Dimes_Home\",\n                           \"pointspreads_bet365_Away\", \"pointspreads_bet365_Home\", \"spreadline_bet365_Away\", \"spreadline_bet365_Home\",\n                           \"OddAway_BET365\", \"OddHome_BET365\", \"spreadsOddAway_BET365\", \"spreadsOddHome_BET365\", \"AwayTeam\", \"HomeTeam\")\n#\"BettingWPAway_BET365\", \"BettingWPHome_BET365\", \"BettingWPAway_5Dimes\", \"BettingWPHome_5Dimes\",\n\n### merge the betting data and pred data \nBettingData <- mutate(BettingData, GameDate = as.Date(as.character(GameDate)))\nRecordGameInfo$W.L <- with(RecordGameInfo, ifelse(RecordGameInfo$Home_Score-RecordGameInfo$Away_Score >0, \"HW\", \"AW\"))\nRecordGameInfo <- mutate(RecordGameInfo, GameDate = as.Date(GameDate))\nFinalBettingandPredData <- merge(RecordGameInfo, BettingData, by = c(\"GameDate\", \"AwayTeam\", \"HomeTeam\"))\nFinalBettingandPredData <- FinalBettingandPredData[, c(\"GameDate\", \"AwayTeam\", \"HomeTeam\", \"Away_Score\", \"Home_Score\", \"W.L\", \n                                   \"AdaMeanAway\", \"AdaFiveAway\", \"AdaThreeAway\", \"SvmMeanAway\", \"SvmFiveAway\", \"SvmThreeAway\", \n                                   \"GameRestDayWPAway\", \"CurrentSeasonWPAway\", \"OpponentWPAway\", \n                                   \"AdaMeanHome\", \"AdaFiveHome\", \"AdaThreeHome\", \"SvmMeanHome\", \"SvmFiveHome\", \"SvmThreeHome\",\n                                   \"GameRestDayWPHome\", \"CurrentSeasonWPHome\", \"OpponentWPHome\", \n                                   \"bet365_Away\", \"bet365_Home\", \"OddAway_BET365\", \"OddHome_BET365\",\n                                   \"pointspreads_bet365_Away\", \"pointspreads_bet365_Home\", \"spreadsOddAway_BET365\", \"spreadsOddHome_BET365\")]\n\n### Predict the next game win precentage\nrequire(psych)\n###ã€€harmonic mean\nharmonicwp.fun <- function(data, variable.1, variable.2, variable.3){\n  har.wp <- apply(data[, c(variable.1, variable.2, variable.3)], 1 ,function(x) harmonic.mean(data.frame(x)))  \n  return(har.wp)\n}\n### strategy - mean\nFinalBettingandPredData$har.adameanAway <- harmonicwp.fun(FinalBettingandPredData, \"AdaMeanAway\", \"GameRestDayWPAway\", \"CurrentSeasonWPAway\")\nFinalBettingandPredData$har.adameanHome <- harmonicwp.fun(FinalBettingandPredData, \"AdaMeanHome\", \"GameRestDayWPHome\", \"CurrentSeasonWPHome\")\nFinalBettingandPredData$har.svmmeanAway <- harmonicwp.fun(FinalBettingandPredData, \"SvmMeanAway\", \"GameRestDayWPAway\", \"CurrentSeasonWPAway\")\nFinalBettingandPredData$har.svmmeanHome <- harmonicwp.fun(FinalBettingandPredData, \"SvmMeanHome\", \"GameRestDayWPHome\", \"CurrentSeasonWPHome\")\n### strategy - five\nFinalBettingandPredData$har.adafiveAway <- harmonicwp.fun(FinalBettingandPredData, \"AdaFiveAway\", \"GameRestDayWPAway\", \"CurrentSeasonWPAway\")\nFinalBettingandPredData$har.adafiveHome <- harmonicwp.fun(FinalBettingandPredData, \"AdaFiveHome\", \"GameRestDayWPHome\", \"CurrentSeasonWPHome\")\nFinalBettingandPredData$har.svmfiveAway <- harmonicwp.fun(FinalBettingandPredData, \"SvmFiveAway\", \"GameRestDayWPAway\", \"CurrentSeasonWPAway\")\nFinalBettingandPredData$har.svmfiveHome <- harmonicwp.fun(FinalBettingandPredData, \"SvmFiveHome\", \"GameRestDayWPHome\", \"CurrentSeasonWPHome\")\n### strategy - three\nFinalBettingandPredData$har.adathreeAway <- harmonicwp.fun(FinalBettingandPredData, \"AdaThreeAway\", \"GameRestDayWPAway\", \"CurrentSeasonWPAway\")\nFinalBettingandPredData$har.adathreeHome <- harmonicwp.fun(FinalBettingandPredData, \"AdaThreeHome\", \"GameRestDayWPHome\", \"CurrentSeasonWPHome\")\nFinalBettingandPredData$har.svmthreeAway <- harmonicwp.fun(FinalBettingandPredData, \"SvmThreeAway\", \"GameRestDayWPAway\", \"CurrentSeasonWPAway\")\nFinalBettingandPredData$har.svmthreeHome <- harmonicwp.fun(FinalBettingandPredData, \"SvmThreeHome\", \"GameRestDayWPHome\", \"CurrentSeasonWPHome\")\n\n### calculate expect value - mean\nFinalBettingandPredData$W.L_adamean <- with(FinalBettingandPredData, ifelse(har.adameanHome-har.adameanAway >0, \"HW\", \"AW\"))\nFinalBettingandPredData$W.L_svmmean <- with(FinalBettingandPredData, ifelse(har.svmmeanHome-har.svmmeanAway >0, \"HW\", \"AW\"))\nFinalBettingandPredData$diffadamean <- with(FinalBettingandPredData, abs(har.adameanHome-har.adameanAway))\nFinalBettingandPredData$diffsvmmean <- with(FinalBettingandPredData, abs(har.svmmeanHome-har.svmmeanAway))\nFinalBettingandPredData$EV_ADAmean <- with(FinalBettingandPredData, ifelse(W.L == W.L_adamean & W.L == \"HW\", OddHome_BET365-1, \n                                                                           ifelse(W.L == W.L_adamean & W.L == \"AW\", OddAway_BET365-1, -1)))\nFinalBettingandPredData$EV_SVMmean <- with(FinalBettingandPredData, ifelse(W.L == W.L_svmmean & W.L == \"HW\", OddHome_BET365-1, \n                                                                           ifelse(W.L == W.L_svmmean & W.L == \"AW\", OddAway_BET365-1, -1)))\nFinalBettingandPredData$reEV_ADAmean <- with(FinalBettingandPredData, ifelse(W.L == \"AW\" & W.L_adamean == \"HW\", OddAway_BET365-1, \n                                                                             ifelse(W.L == \"HW\" & W.L_adamean == \"AW\", OddHome_BET365-1, -1)))\nFinalBettingandPredData$reEV_SVMmean <- with(FinalBettingandPredData, ifelse(W.L == \"AW\" & W.L_svmmean == \"HW\", OddAway_BET365-1, \n                                                                             ifelse(W.L == \"HW\" & W.L_svmmean == \"AW\", OddHome_BET365-1, -1)))\n\n### calculate expect value - five\nFinalBettingandPredData$W.L_adafive <- with(FinalBettingandPredData, ifelse(har.adafiveHome-har.adafiveAway >0, \"HW\", \"AW\"))\nFinalBettingandPredData$W.L_svmfive <- with(FinalBettingandPredData, ifelse(har.svmfiveHome-har.svmfiveAway >0, \"HW\", \"AW\"))\nFinalBettingandPredData$diffadafive <- with(FinalBettingandPredData, abs(har.adafiveHome-har.adafiveAway))\nFinalBettingandPredData$diffsvmfive <- with(FinalBettingandPredData, abs(har.svmfiveHome-har.svmfiveAway))\nFinalBettingandPredData$EV_ADAfive <- with(FinalBettingandPredData, ifelse(W.L == W.L_adafive & W.L == \"HW\", OddHome_BET365-1, \n                                                                           ifelse(W.L == W.L_adafive & W.L == \"AW\", OddAway_BET365-1, -1)))\nFinalBettingandPredData$EV_SVMfive <- with(FinalBettingandPredData, ifelse(W.L == W.L_svmfive & W.L == \"HW\", OddHome_BET365-1, \n                                                                           ifelse(W.L == W.L_svmfive & W.L == \"AW\", OddAway_BET365-1, -1)))\nFinalBettingandPredData$reEV_ADAfive <- with(FinalBettingandPredData, ifelse(W.L == \"AW\" & W.L_adafive == \"HW\", OddAway_BET365-1, \n                                                                             ifelse(W.L == \"HW\" & W.L_adafive == \"AW\", OddHome_BET365-1, -1)))\nFinalBettingandPredData$reEV_SVMfive <- with(FinalBettingandPredData, ifelse(W.L == \"AW\" & W.L_svmfive == \"HW\", OddAway_BET365-1, \n                                                                             ifelse(W.L == \"HW\" & W.L_svmfive == \"AW\", OddHome_BET365-1, -1)))\n\n### calculate expect value - three\nFinalBettingandPredData$W.L_adathree <- with(FinalBettingandPredData, ifelse(har.adathreeHome-har.adathreeAway >0, \"HW\", \"AW\"))\nFinalBettingandPredData$W.L_svmthree <- with(FinalBettingandPredData, ifelse(har.svmthreeHome-har.svmthreeAway >0, \"HW\", \"AW\"))\nFinalBettingandPredData$diffadathree <- with(FinalBettingandPredData, abs(har.adathreeHome-har.adathreeAway))\nFinalBettingandPredData$diffsvmthree <- with(FinalBettingandPredData, abs(har.svmthreeHome-har.svmthreeAway))\nFinalBettingandPredData$EV_ADAthree <- with(FinalBettingandPredData, ifelse(W.L == W.L_adathree & W.L == \"HW\", OddHome_BET365-1, \n                                                                           ifelse(W.L == W.L_adathree & W.L == \"AW\", OddAway_BET365-1, -1)))\nFinalBettingandPredData$EV_SVMthree <- with(FinalBettingandPredData, ifelse(W.L == W.L_svmthree & W.L == \"HW\", OddHome_BET365-1, \n                                                                           ifelse(W.L == W.L_svmthree & W.L == \"AW\", OddAway_BET365-1, -1)))\nFinalBettingandPredData$reEV_ADAthree <- with(FinalBettingandPredData, ifelse(W.L == \"AW\" & W.L_adathree == \"HW\", OddAway_BET365-1, \n                                                                             ifelse(W.L == \"HW\" & W.L_adathree == \"AW\", OddHome_BET365-1, -1)))\nFinalBettingandPredData$reEV_SVMthree <- with(FinalBettingandPredData, ifelse(W.L == \"AW\" & W.L_svmthree == \"HW\", OddAway_BET365-1, \n                                                                             ifelse(W.L == \"HW\" & W.L_svmthree == \"AW\", OddHome_BET365-1, -1)))\n### output the outcome\nAll_star_game_date <- which(FinalBettingandPredData$GameDate[2:length(FinalBettingandPredData$GameDate)]-\n                              FinalBettingandPredData$GameDate[1:length(FinalBettingandPredData$GameDate)-1] > 4)\n\nwrite.xlsx2(FinalBettingandPredData[(1:All_star_game_date), ],\n            sprintf(\"~/Documents/Sport_analysis/basketball//Betting_Data//final_%s.xlsx\", SeasonCurrent), \n            row.names = FALSE, sheetName = \"Pre\")\nwrite.xlsx2(FinalBettingandPredData[(All_star_game_date+1:length(FinalBettingandPredData$GameDate)), ] ,\n            sprintf(\"~/Documents/Sport_analysis/basketball//Betting_Data//final_%s.xlsx\", SeasonCurrent), \n            row.names = FALSE, append = TRUE, sheetName = \"Post\")\n",
    "created" : 1430843981411.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1212573155",
    "id" : "7F128A8D",
    "lastKnownWriteTime" : 1430758544,
    "path" : "~/Documents/Sport_analysis/basketball/NBA_Prediction_Analysis/NBA_PredandBetting.R",
    "project_path" : "NBA_PredandBetting.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}